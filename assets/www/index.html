
<!DOCTYPE HTML> 
<html>
<head>
<meta name="viewport" content="width=320; user-scalable=no" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8">

<title>RunforHealth</title>

    <script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    
<!-- CSS Style Sheet -->
<link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css">
<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.1.css">

<!-- JQM  -->
<script src="js/jquery-1.9.0.js"></script>
<script src="js/jquery.mobile-1.3.1.min.js"></script>



    <style type="text/css">
	html {height:100%}
	body {height:100%; margin:0; padding:0}
	#map_canvas {height:100%; width:100%}
	</style>
    
    <script type="text/javascript" charset="utf-8">
    
    // ----------------------Time Set--------------------------------------------------
      var ms = 0;
		var state = 0;

		function startstop() {
			if (state == 0) {
			state = 1;
			then = new Date();
			then.setTime(then.getTime() - ms);
			}   
			else {
			state = 0;
			now = new Date();
			ms = now.getTime() - then.getTime();

			hours = Math.floor(ms%(1000 * 60 * 60 * 24)/(1000 * 60 * 60));
			if (hours < 10)
			hours = "0" + hours

			minutes = Math.floor((ms%(1000 * 60 * 60))/(1000 * 60));
			if (minutes < 10)
			minutes = "0" + minutes

			seconds = Math.floor((ms%(1000 * 60))/1000);
			if (seconds < 10)
			seconds = "0" + seconds
    	
			document.all('timer').innerHTML = '<h1>'+hours+':'+minutes+':'+seconds+'</h1>';
   	   		}
		}

		function swreset() {
			state = 0;
			ms = 0;
			document.all('timer').innerHTML = '<h1>00:00:00</h1>';
		}

		function display() {
		setTimeout("display();", 500);
		if (state == 1)  {
		now = new Date();
		ms = now.getTime() - then.getTime();
		hours = Math.floor(ms%(1000 * 60 * 60 * 24)/(1000 * 60 * 60));
		if (hours < 10)
		hours = "0" + hours

		minutes_divisor = ms%(1000 * 60 * 60);
		minutes = Math.floor(minutes_divisor/(1000 * 60));
		if (minutes < 10)
		minutes = "0" + minutes

		seconds_divisor = ms%(1000 * 60);
		seconds = Math.floor(seconds_divisor/1000);
		if (seconds < 10)
		seconds = "0" + seconds

		document.all('timer').innerHTML = '<h1>'+hours+':'+minutes+':'+seconds+'</h1>';
   		}
		}
        </script>

</head>  
  
<body>  
  


   <div data-role="page" id="page">

    <div data-role="header" align="center" data-position="fixed">
		<h1>RunforHealth</h1>
	</div><br>
	<table border="0" cellspacing="0" cellpadding="0" align="CENTER">
	<tr>
	<td colspan="2" width="351" height="251">
	<div id="map_canvas" align="center"></div>
	</td>
	</tr>

    </table>
    <table border="0" cellspacing="0" cellpadding="0" align="CENTER">
    <form NAME="stpw">
 <tr>
	<td>
    <h4>Time&nbsp;:&nbsp;</h4>
    </td>
    <td>
	<div id="timer" class="logininput" align="center"><h1>00:00:00</h1></div>
    </td>
</tr>
<tr>
	<td colspan="2">
	<div onClick="display()" >
	<input TYPE="BUTTON" Name="ssbutton" VALUE="Start/Stop" onClick="startstop()">
	<input TYPE="BUTTON" NAME="reset" VALUE="End" onClick="swreset()">
	</div>
	</form>
    	</td>
</tr>
</table>
</div>
  
  <div id="map_control_tool">  
    <input type="button" name="button" id="button" value="Clear Map Polylines" onclick="clearMapPolylines();" />  
  </div>  
 
    
<script src="http://code.jquery.com/jquery-latest.js"></script>    
<script type="text/javascript">  

        var options = { timeout: 30000 };
        var watchID = navigator.geolocation.watchPosition(initialize, onError, options);

var map; // กำหนดตัวแปร map ไว้ด้านนอกฟังก์ชัน เพื่อให้สามารถเรียกใช้งาน จากส่วนอื่นได้  
var GGM; // กำหนดตัวแปร GGM ไว้เก็บ google.maps Object จะได้เรียกใช้งานได้ง่ายขึ้น  
var arr_path=[]; // กำหนดตัวแปรสำหรับเก็บค่าอาเรย์ ตำแหน่ง path  
var makePolyline; // กำหนดตัวแปร ฟังก์ชั่น สร้างเส้น polylines  
var objPolylines=[]; // กำหนดตัวแปรสำหรับเก็บค่า object ของ polylines  
function initialize(position) { // ฟังก์ชันแสดงแผนที่  
    GGM=new Object(google.maps); // เก็บตัวแปร google.maps Object ไว้ในตัวแปร GGM  
    // กำหนดจุดเริ่มต้นของแผนที่  
    var my_Latlng  =  new GGM.LatLng(position.coords.latitude,position.coords.longitude); 
    var my_mapTypeId=GGM.MapTypeId.ROADMAP; // กำหนดรูปแบบแผนที่ที่แสดง  
    // กำหนด DOM object ที่จะเอาแผนที่ไปแสดง ที่นี้คือ div id=map_canvas  
    var my_DivObj=$("#map_canvas")[0];   
    // กำหนด Option ของแผนที่  
    var myOptions = {  
        zoom: 16, // กำหนดขนาดการ zoom  
        center: my_Latlng , // กำหนดจุดกึ่งกลาง  
        mapTypeId:my_mapTypeId // กำหนดรูปแบบแผนที่  
    };  
    map = new GGM.Map(my_DivObj,myOptions);// สร้างแผนที่และเก็บตัวแปรไว้ในชื่อ map  
      
    var my_Marker = new GGM.Marker({ // สร้างตัว marker  
        position: my_Latlng,  // กำหนดไว้ที่เดียวกับจุดกึ่งกลาง  
        map: map, // กำหนดว่า marker นี้ใช้กับแผนที่ชื่อ instance ว่า map  
        draggable:false, // กำหนดให้สามารถลากตัว marker นี้ได้  
        title:"คลิกลากเพื่อหาตำแหน่งจุดที่ต้องการ!" // แสดง title เมื่อเอาเมาส์มาอยู่เหนือ  
    });  
    
      
    // กำหนด event ให้กับตัว marker เมื่อสิ้นสุดการลากตัว marker ให้ทำงานอะไร  
    GGM.event.addListener(map, "bounds_changed", function() {  
        var my_Point = my_Marker.getPosition(my_Latlng);  // หาตำแหน่งของตัว marker เมื่อกดลากแล้วปล่อย  
        arr_path.push(my_Point); // เพิ่มค่าตำแหน่ง จากตัว marker ตำแหน่งล่าสุด  
        map.panTo(my_Point);  // ให้แผนที่แสดงไปที่ตัว marker ล่าสุด  
                  
        makePolyline(arr_path); // ส่งค่าตำแหน่งใน array ไปสร้างเส้น polylines ในแผนที่  
//      console.log(arr_path);  
    });       
  
    // กำหนด event ให้กับตัวแผนที่ เมื่อมีการเปลี่ยนแปลงการ zoom  
    GGM.event.addListener(map, "zoom_changed", function() {  
        $("#zoom_value").val(map.getZoom()); // เอาขนาด zoom ของแผนที่แสดงใน textbox id=zoom_value    
    });  
}  

function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
  
makePolyline=function(arr_path){  
//  console.log(arr_path.length);  
    var i=arr_path.length-1;  
    objPolylines[i] = new GGM.Polyline({ // กำหนดรูปแบบของเส้น polylines  
        path: arr_path,// array ตำแหน่งที่เก็บค่า lat,lon  
        strokeColor: "#FF0000", // สี  
        strokeOpacity: 1.0, // ความโปร่งใส  
        strokeWeight: 2 //ความหน้าของเส้น  
    });   
    objPolylines[i].setMap(map);    // สร้างเส้น polylines ในแผนที่  
//  console.log(arr_path);  
//  console.log(objPolylines);  
}  
clearMapPolylines=function(){  
    arr_path=[];      
    for(i=0;i<objPolylines.length;i++){  
//      console.log(i);  
        objPolylines[i].setMap(null);  
    }  
  
//  console.log(arr_path);  
}  
$(function(){  
    // โหลด สคริป google map api เมื่อเว็บโหลดเรียบร้อยแล้ว  
    // ค่าตัวแปร ที่ส่งไปในไฟล์ google map api  
    // v=3.2&sensor=false&language=th&callback=initialize  
    //  v เวอร์ชัน่ 3.2  
    //  sensor กำหนดให้สามารถแสดงตำแหน่งทำเปิดแผนที่อยู่ได้ เหมาะสำหรับมือถือ ปกติใช้ false  
    //  language ภาษา th ,en เป็นต้น  
    //  callback ให้เรียกใช้ฟังก์ชันแสดง แผนที่ initialize  
    $("<script/>", {  
      "type": "text/javascript",  
      src: "http://maps.google.com/maps/api/js?v=3.2&sensor=false&language=th&callback=initialize"  
    }).appendTo("body");      
});  
</script>    
</body>  
</html>  
